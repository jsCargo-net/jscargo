{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://jscargo.net/schemas/jscargo-core.schema.json",
  "type": "object",
  "properties": {
    "$schemaVersion": {
      "type": "string",
      "description": "JSON Schema version (defaults to version)",
      "default": "1.0"
    },
    "version": {
      "type": "string",
      "default": "1.0",
      "description": "Schema version"
    },
    "metadata": {
      "type": "object",
      "properties": {
        "title": { "type": "string", "description": "Media title" },
        "description": { "type": "string", "description": "Media description" },
        "duration": { "type": "number", "description": "Duration in seconds" },
        "contentId": { "type": "string", "description": "Unique content ID" },
        "createdAt": { "type": "string", "format": "date-time", "description": "Creation timestamp" },
        "updatedAt": { "type": "string", "format": "date-time", "description": "Update timestamp" },
        "expiresAt": { "type": "string", "format": "date-time", "description": "Expiration timestamp" },
        "contentVersion": { "type": "string", "description": "Content version (e.g., '1.0.1')" },
        "accessibility": {
          "type": "array",
          "items": { "type": "string", "enum": ["describedAudio", "signLanguage"] },
          "description": "Accessibility features available (e.g., described audio, sign language)"
        }
      },
      "required": ["title"],
      "additionalProperties": false
    },
    "sources": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "url": { "type": "string", "format": "uri", "description": "Source URL (e.g., .m3u8, .mpd, .mp3, .jpg, world API, chat log)" },
          "type": { "type": "string", "enum": ["hls", "dash", "mp3", "aac", "image", "world", "chat"], "description": "Source type" },
          "mimeType": { "type": "string", "description": "MIME type of the source (e.g., 'application/x-mpegURL', 'audio/mpeg', 'application/json')" },
          "streamType": { "type": ["string", "null"], "enum": ["vod", "live", null], "description": "Stream type, null for non-streaming" },
          "geoRestrictions": { "type": "array", "items": { "type": "string" }, "description": "Allowed country codes" },
          "drm": {
            "type": "object",
            "properties": {
              "type": { "type": "string", "description": "DRM type (e.g., 'widevine')" },
              "licenseUrl": { "type": "string", "format": "uri", "description": "DRM license URL" },
              "keyId": { "type": "string", "description": "DRM key ID" },
              "encryptionScheme": { "type": "string", "description": "Encryption scheme" }
            },
            "additionalProperties": true,
            "description": "Per-stream DRM configuration (overrides metadata.drm)"
          }
        },
        "required": ["url", "type"],
        "additionalProperties": false
      },
      "description": "Array of media sources"
    },
    "tracks": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "url": { "type": "string", "format": "uri", "description": "Track file URL" },
          "srclang": { "type": "string", "description": "Language code (e.g., 'en')" },
          "label": { "type": "string", "description": "Display label (e.g., 'English')" },
          "kind": { "type": "string", "enum": ["subtitles", "captions", "descriptions", "altText", "message"], "description": "Track type" },
          "format": { "type": "string", "enum": ["vtt", "ttml", "txt"], "description": "Track format" },
          "forced": { "type": "boolean", "default": false, "description": "Forced track" },
          "embedded": { "type": "boolean", "default": false, "description": "Embedded in container" },
          "autoGenerated": { "type": "boolean", "default": false, "description": "Auto-generated track" },
          "role": { "type": "string", "enum": ["user", "assistant"], "description": "Role for message tracks (e.g., user or assistant)" },
          "extensions": {
            "type": "object",
            "properties": {
              "styling": { "type": "object", "description": "WebVTT/TTML styling" }
            },
            "additionalProperties": true
          }
        },
        "required": ["url", "srclang", "label"],
        "additionalProperties": false
      },
      "description": "Array of media tracks"
    },
    "variants": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "label": { "type": "string", "description": "Variant label (e.g., '720p')" },
          "width": { "type": "number", "description": "Width in pixels" },
          "height": { "type": "number", "description": "Height in pixels" },
          "bitrate": { "type": "number", "description": "Bitrate in kbps" },
          "codec": { "type": "string", "description": "Codec (e.g., 'h264')" },
          "frameRate": { "type": "number", "description": "Frame rate in fps" },
          "sampleRate": { "type": "number", "description": "Audio sample rate in Hz" },
          "format": { "type": "string", "description": "Image format (e.g., 'jpeg', 'webp')" },
          "streamType": { "type": ["string", "null"], "enum": ["vod", "live", null], "description": "Stream type for this variant, overrides source streamType" }
        },
        "required": ["label"],
        "anyOf": [
          { "required": ["width", "height"] },
          { "required": ["bitrate"] },
          { "required": ["format"] }
        ],
        "additionalProperties": false
      },
      "description": "Array of media variants"
    },
    "poster": { "type": "string", "format": "uri", "description": "URL to the poster image" },
    "thumbnail": { "type": "string", "format": "uri", "description": "URL to a thumbnail image" },
    "autoplay": { "type": "boolean", "default": false, "description": "Autoplay media" },
    "muted": { "type": "boolean", "default": false, "description": "Muted media" },
    "loop": { "type": "boolean", "default": false, "description": "Loop media" },
    "controls": { "type": "boolean", "default": true, "description": "Show player controls" },
    "aspectRatio": { "type": "string", "default": "16:9", "description": "Aspect ratio (e.g., '16:9', '1:1')" },
    "startTime": { "type": "number", "default": 0, "description": "Start time in seconds" },
    "auth": {
      "type": "object",
      "properties": {
        "type": { "type": "string", "enum": ["jwt", "bearer", "oauth"], "description": "Auth type" },
        "token": { "type": "string", "description": "Auth token" }
      },
      "required": ["type", "token"],
      "additionalProperties": false
    }
  },
  "required": ["version", "metadata", "sources"],
  "additionalProperties": false
}